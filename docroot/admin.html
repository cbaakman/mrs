<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE xhtml
	PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/1999/xhtml">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:mrs="http://mrs.cmbi.ru.nl/mrs-web/ml"
	xml:lang="en" lang="en">
<head>
    <title>M6 Administration</title>

    <meta name="author" content="Maarten L. Hekkelman" />
    <meta name="generator" content="Japi" />
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />

	<link rel="stylesheet" type="text/css" href="css/mrs-style.css" />

	<script src="scripts/jquery.js" type="text/javascript">
	</script>
	
	<script src="scripts/mrs.js" type="text/javascript">
	</script>

	<script src="scripts/admin.js" type="text/javascript">
	</script>

</head>
<body>
	<mrs:include file="menu.html" />
	<div id="main">
		<mrs:include file="form.html" />
		<div class="nav">
			<ul>
				<li><a href="#" id="global" onclick="Admin.changeStatsView('global');">Main</a></li>
				<li><a href="#" id="server" onclick="Admin.changeStatsView('server');">Server</a></li>
				<li><a href="#" id="parsers" onclick="Admin.changeStatsView('parsers');">Parsers</a></li>
				<li><a href="#" id="formats" onclick="Admin.changeStatsView('formats');">Formats</a></li>
				<li><a href="#" id="databanks" onclick="Admin.changeStatsView('databanks');">Databanks</a></li>
<!--				<li><a href="#" id="blast" onclick="Admin.changeStatsView('blast');">Blast</a></li>-->
			</ul>
		</div>

		<div class="admin">
			<div id="global" class="section">
				<form class="admin_form" method="POST">
					<input type='hidden' name='submit' value='global'/>
					<fieldset>
						<h3>Directories</h3>
						<div><label>MRS files</label><input type="text" value="${global.dirs['mrs']}" name="mrs"/></div>
						<div><label>Raw files</label><input type="text" value="${global.dirs['raw']}" name="raw"/></div>
						<div><label>Parser</label><input type="text" value="${global.dirs['parser']}" name="parser"/></div>
						<div><label>Docroot</label><input type="text" value="${global.dirs['docroot']}" name="docroot"/></div>
						<div><label>Blast cache</label><input type="text" value="${global.dirs['blast']}" name="blast"/></div>
						<h3>Tools</h3>
						<div><label>Clustal Omega</label><input type="text" value="${global.tools.clustalo}" name="clustalo"/></div>
						<hr/>
						<input type='submit' value='Submit'/><input type='reset' value='Reset'/>
					</fieldset>
				</form>

				<form class="admin_form" method="POST">
					<input type="hidden" name="submit" value="restart"/>
					
					<fieldset>
						<h3>Restart</h3>
						<p>After changing the configuration options you have to restart the server
						to make sure these changes are taken into effect.</p>
						<input type='submit' value='Restart'/>
					</fieldset>
				</form>
			</div>
			
			<div id="server" class="section">
				<form id="server-${server.nr}" class="admin_form" method="POST">
					<input type='hidden' name='submit' value='server'/>
					<input type='hidden' name='nr' value="${db.nr}"/>
					<fieldset>
						<h3>Server configuration</h3>
						<div><label>Address</label><input type="text" value="${server.addr}" name="addr"/></div>
						<div><label>Port</label><input type="text" value="${server.port}" name="port"/></div>
						<div><label>Base URL</label><input type="text" value="${server.baseurl}" name="baseurl"/></div>
						
						<h3>Web Service Locations</h3>
						<p>Leave empty to disable web service</p>
						<div><label>Search</label><input type="text" value="${server.ws['search']}" name="search"/></div>
						<div><label>Blast</label><input type="text" value="${server.ws['blast']}" name="blast"/></div>
<!--						<div><label>Align</label><input type="text" value="${server.ws['align']}" name="align"/></div>-->
						<hr/>
						<input type='submit' value='Submit'/><input type='reset' value='Reset'/>
					</fieldset>
				</form>

			</div>
			
			<div id="parsers" class="section">
				<div class="admin-left">
					<table cellspacing="0" cellpadding="0" class="select_form">
						<caption>Parsers</caption>
						<mrs:iterate collection="parsers" var="parser">
							<tr><td>${parser.id}</td></tr>
						</mrs:iterate>
					</table>
				</div>
				
				<div class="admin-right">
					<mrs:iterate collection="parsers" var="parser">
					<form id="${parser.id}" class="admin_form" method="post" style="display:none">
						<input type='hidden' name='submit' value='parsers'/>
						<fieldset>
							<h3>Parser configuration</h3>
							<mrs:if test="${empty parser.script}">
							<p>XML parsers are not configurable in the admin pages yet</p>	
							</mrs:if>
							<mrs:if test="${parser.script}">
							<p>Perl based parsers should be edited directly, you can find the
							file for the <code>${parser.id}</code> parser at <code style="white-space:nowrap">${parser.script}</code></p>
							</mrs:if>
						</fieldset>
					</form>
					</mrs:iterate>
				</div>
				
				<div class="admin-clear" />
			</div>
				
			<div id="formats" class="section">
				<div class="admin-left">
					<table cellspacing="0" cellpadding="0" class="select_form">
						<caption>Formats</caption>
						<mrs:iterate collection="formats" var="format">
							<tr><td>${format.id}</td></tr>
						</mrs:iterate>
					</table>
				</div>
				
				<div class="admin-right">
				<mrs:iterate collection="formats" var="format">
					<form id="${format.id}" class="admin_form" method="POST" style="display:none">
						<fieldset>
							<h3>Format specification â€” ${format.id}</h3>
							<input type='hidden' name='submit' value='formats'/>
							<input type='hidden' name='fmt' value='${format.id}'/>

							<p>Formatting a document is done using JavaScript plugins. To specify a script for the ${format.id}
							format choose one from the list here which is based on the files found in
							<code>${global.dirs['docroot']}/formats</code>.</p>

								<div><label>JavaScript</label><select name="script">
									<option value="">No script</option>
									<mrs:options collection="scripts" value="id" label="id" selected="${format.script}"/>
								</select></div>
							<h3>Links</h3>
							<p>Create 'live' links in documents based on a regular expression. You can reference captures in the
							regular expression using the variable names $1 for the first capture, $2 for the second, etc.</p>
							<table cellspacing="0" cellpadding="0" style="${empty format.links ? 'display:none' : ''}">
								<tr>
									<th>Regular Expression</th>
									<th>Target Databank</th>
									<th>Target ID</th>
									<th>Index</th>
									<th>Anchor</th>
									<th/>
								</tr>
							<mrs:iterate collection="${format.links}" var="link">
								<tr>
									<td><input type="text" value="${link.rx}" name="rx"/></td>
									<td><select name="db"><mrs:options collection="aliases" selected="${link.db}" /></select></td>
									<td><input type="text" value="${link.id}" name="id"/></td>
									<td><input type="text" value="${link.ix}" name="ix"/></td>
									<td><input type="text" value="${link.an}" name="an"/></td>
									<td><div class="delete">Delete</div></td>
								</tr>
							</mrs:iterate>
								<tr style="display:none">
									<td><input type="text" name="rx"/></td>
									<td><select name="db"><mrs:options collection="aliases" /></select></td>
									<td><input type="text" name="id"/></td>
									<td><input type="text" name="ix"/></td>
									<td><input type="text" name="an"/></td>
									<td><div class="delete">Delete</div></td>
								</tr>
							</table>
							<button onclick='Admin.addLinkToFormat("${format.id}"); return false;'>Add link</button>
							
							<hr/>
							<input type='submit' value='Submit'/><input type='reset' value='Reset'/>
						</fieldset>
					</form>
					
				</mrs:iterate>
				</div>
				
				<div class="admin-clear" />
			</div>
	
			<div id="databanks" class="section">
				<div class="admin-left">
					<table cellspacing="0" cellpadding="0" class="select_form">
						<caption>Databanks</caption>
						<mrs:iterate collection="config-databanks" var="db">
							<tr><td>${db.id}</td></tr>
						</mrs:iterate>
					</table>
				</div>
				
				<div class="admin-right">
				<mrs:iterate collection="config-databanks" var="db">
					<form id="${db.id}" class="admin_form" method="POST" style="display:none">
						<fieldset>
							<h3>Databank information</h3>
							<input type='hidden' name='submit' value='databanks'/>
							<div><label>ID</label><input type="text" value="${db.id}" name="id"/></div>
							<div><label>Enabled</label><mrs:checkbox name="enabled" checked="${db.enabled}"/></div>
							<div><label>Aliases</label><input type="text" value="${db.aliases}" name="aliases"/></div>
							<div><label>Name</label><input type="text" value="${db.name}" name="name"/></div>
							<div><label>Info URL</label><input type="text" value="${db.info}" name="info"/></div>

							<h3>Data retrieval</h3>
							<div><label>Update</label><select name="update">
								<mrs:option value="never" selected="${db.update}">never</mrs:option>
								<mrs:option value="daily" selected="${db.update}">daily</mrs:option>
								<mrs:option value="weekly" selected="${db.update}">weekly</mrs:option>
								<mrs:option value="monthly" selected="${db.update}">monthly</mrs:option>
							</select></div>
							<div><label>Source files</label><input type="text" value="${db.source}" name="source"/></div>
							<div><label>Upstream URL</label><input type="text" value="${db.fetch.src}" name="fetch"/></div>
							<div><label>Delete stale files</label><mrs:checkbox name="delete" checked="${db.fetch.delete}"/></div>
							
							<h3>Data processing</h3>
							<div><label>Parser</label><select name="parser">
									<mrs:options collection="parsers" value="id" label="id" selected="${db.parser}"/>
								</select>
							</div>
							<div><label>Filter</label><input type="text" value="${db.filter}" name="filter"/></div>
							<div><label>Formatter</label><select name="format" onchange="Admin.changeFormat('${db.id}');">
									<option value="none">No format</option>
									<mrs:option value="xml" selected="${db.format}">XML Stylesheet</mrs:option>
									<mrs:options collection="formats" value="id" label="id" selected="${db.format}"/>
								</select>
								<input type="text" value="${db.stylesheet}" name="stylesheet" style="display:none; width: 250px"/>
							</div>

							<hr/>
							<input type='submit' value='Submit'/><input type='reset' value='Reset'/>
						</fieldset>
					</form>
					
				</mrs:iterate>
				</div>
				
				<div class="admin-clear" />
			</div>
	
<!--			<div id="blast" class="section">-->
<!--				<form class="admin_form" method="POST">-->
<!--					<input type='hidden' name='submit' value='blast'/>-->
<!--					<fieldset>-->
<!--						<h3>Blast Cache</h3>-->
<!--						<div><label>Clustal Omega</label><input type="text" value="${global.tools.clustalo}" name="clustalo"/></div>-->
<!--						<hr/>-->
<!--						<input type='submit' value='Submit'/><input type='reset' value='Reset'/>-->
<!--					</fieldset>-->
<!--				</form>-->
<!--			</div>-->
		
		</div>
		
	</div>
</body>
</html>
